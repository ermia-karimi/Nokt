<!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <title>Ù†Ú©ØªØ§ | Ù¾ÛŒ Ø¯ÛŒ Ø§Ù Ø¨Ù‡ Ù…ØªÙ† </title>


    <script type="module">
        import * as pdfjsLib from 'https://unpkg.com/pdfjs-dist@5.4.149/build/pdf.mjs';
        pdfjsLib.GlobalWorkerOptions.workerSrc =
            'https://unpkg.com/pdfjs-dist@5.4.149/build/pdf.worker.mjs';

        window.startProcess = async file => {
            const out = document.getElementById('output');
            out.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´';

            const buffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;

            let finalText = '';
            let totalPages = pdf.numPages;
            let donePages = 0;
            let displayedPercent = 0;

            function smoothUpdate(target) {
                const animate = () => {
                    if (displayedPercent < target) {
                        displayedPercent += Math.min(0.5, target - displayedPercent);
                        document.getElementById('bar').style.width = displayedPercent + '%';
                        requestAnimationFrame(animate);
                    } else {
                        displayedPercent = target;
                        document.getElementById('bar').style.width = displayedPercent + '%';
                    }
                }
                animate();
            }

            for (let i = 1; i <= totalPages; i++) {
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 4 });
                const canvas = document.createElement('canvas');
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                const ctx = canvas.getContext('2d');
                await page.render({ canvasContext: ctx, viewport }).promise;

                const { data } = await Tesseract.recognize(
                    canvas,
                    'fas+eng',
                    {
                        logger: m => {
                            if (m.status === 'recognizing text') {
                                const progressPercent = ((donePages + m.progress) / totalPages) * 100;
                                smoothUpdate(progressPercent);
                            }
                        }
                    }
                );

                // ---------- ÙÛŒÙ„ØªØ± Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ ----------
                const paragraphs = data.blocks
    .map(b => b.text)
    .filter(t => {
        t = t.trim();
        if (!t) return false;

        // Ø­Ø°Ù Ù…ØªÙ† Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø´Ø§Ù…Ù„ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ù…Ø´Ø®Øµ Ù‡Ø³ØªÙ†Ø¯
        if (/(ØªÙ…Ø±ÛŒÙ†|ÙØ¹Ø§Ù„ÛŒØª|Ù¾Ø§ÙˆØ±Ù‚ÛŒ)/i.test(t)) return false;

        // Ø­Ø°Ù Ø®Ø·ÙˆØ· Ø¬Ø¯ÙˆÙ„
        if (/Ø¬Ø¯ÙˆÙ„\s*\d+/i.test(t)) return false;

        return true;
    });



                finalText += fixText(paragraphs.join('\n\n')) + '\n\n';
                donePages++;
                smoothUpdate((donePages / totalPages) * 100);
            }

            out.textContent = finalText;
        };

        /* ---------- Ø§ØµÙ„Ø§Ø­ Ù…ØªÙ† ---------- */
        function fixText(text) {
            // Ù…Ø±Ø­Ù„Ù‡ 1: Ø§ØµÙ„Ø§Ø­ Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÛŒ Ùˆ Ù†ÛŒÙ…â€ŒÙØ§ØµÙ„Ù‡
            text = text.replace(/ÙŠ/g, 'ÛŒ').replace(/Ùƒ/g, 'Ú©').replace(/\u200c/g, ' ');

            // Ù…Ø±Ø­Ù„Ù‡ 2: Ø§ØµÙ„Ø§Ø­ ÙØ§ØµÙ„Ù‡ Ùˆ Ø¹Ù„Ø§Ø¦Ù…
            text = text.replace(/\n([\.\!\?\ØŸ\:]+)/g, '$1');
            text = text.replace(/\s+([\.\!\?\ØŸ\:])/g, '$1');
            text = text.replace(/([\.\!\?\ØŸ\:])(?=\S)/g, '$1 ');
            text = text.replace(/([^\.\!\?\ØŸ\:])\n+(?=[Ø¢-ÛŒ])/g, '$1 ');
            text = text.replace(/\bÙ…ÛŒ\s+/g, 'Ù…ÛŒâ€Œ');
            text = text.replace(/\bÙ†Ù…ÛŒ\s+/g, 'Ù†Ù…ÛŒâ€Œ');

            // Ù…Ø±Ø­Ù„Ù‡ 3: Ø­Ø°Ù Ù†ÙˆÛŒØ² Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¯Ø§Ø®Ù„ Ú©Ù„Ù…Ø§Øª ÙØ§Ø±Ø³ÛŒ
            text = text.replace(/([Ø¢-ÛŒ])([A-Za-z]+)(?=[Ø¢-ÛŒ])/g, '$1');

            // Ù…Ø±Ø­Ù„Ù‡ 4: Ø­Ø°Ù Ù†ÙˆÛŒØ² Ú©Ø§Ù…Ù„ (ÙÙ‚Ø· Ø­Ø±ÙˆÙ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ø¹Ø¯Ø§Ø¯)
            text = text.replace(/[^Ø¢-ÛŒ0-9Û°-Û¹\s\.\!\?\ØŸ\:\,\-\/\(\)Â«Â»"']/g, '');

            // Ù…Ø±Ø­Ù„Ù‡ 5: Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙØ§ØµÙ„Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡
            text = text.replace(/\s+/g, ' ').trim();

            return text;
        }






    </script>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
</head>

<body>
    <a class="ar" id="ar" href="index.html">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
    <div class="all-pdf">


        <!-- <h3>OCR ÙØ§Ø±Ø³ÛŒ â€” Ú©ÛŒÙÛŒØª Ø¨Ø§Ù„Ø§ + Smooth Progress</h3> -->




        <div class="file-upload">

            <input type="file" id="pdfInput" accept="application/pdf" class="in">
            <label id="pickLabel" class="btn1" for="pdfInput" title=""></label>

        </div>


        <div class="btnd">

            <button onclick="copyText()" class="btnk">ğŸ“‹ Ú©Ù¾ÛŒ</button>
            <button onclick="downloadText()" class="btnk">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯</button>

        </div>



        <div class="progressBox">
            <div class="progressBar" id="bar"></div>
        </div>
        <pre id="output"
            placeholder="ØªØ§ Ø­Ø¯ Ø§Ù…Ú©Ø§Ù† Ø§Ø² Ù¾ÛŒ Ø¯ÛŒ Ø§Ù Ù‡Ø§ÛŒ Ø§Ø³Ú©Ù† Ø´Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†ÛŒØ¯">ØªØ§ Ø­Ø¯ Ø§Ù…Ú©Ø§Ù† Ø§Ø² Ù¾ÛŒ Ø¯ÛŒ Ø§Ù Ù‡Ø§ÛŒ Ø§Ø³Ú©Ù† Ø´Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†ÛŒØ¯</pre>


    </div>

    <script>
        alert("Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…ÛŒØªÙˆÙ†ÛŒØ¯ Ù…ØªÙ† Ù¾ÛŒ Ø¯ÛŒ Ø§Ù Ø±Ùˆ Ø®ÙˆØ¯ØªÙˆÙ† Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯ Ø§Ø² Ø§ÙˆÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ ØªØ§ Ù…ØªÙ† Ø¨Ø§ Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ú©ÛŒÙÛŒØª Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯")
        pdfInput.onchange = e => {
            if (e.target.files[0]) startProcess(e.target.files[0]);
        };

        function copyText() {
            const text = document.getElementById('output').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('Ù…ØªÙ† Ú©Ù¾ÛŒ Ø´Ø¯');
            }).catch(err => {
                alert('Ú©Ù¾ÛŒ Ù†Ø´Ø¯: ' + err);
            });
        }

        function downloadText() {
            const text = output.textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ocr.txt';
            a.click();
        }
    </script>
</body>

</html>





























<!-- <!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <title>Ù†Ú©ØªØ§ | PDF Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ø¨Ù‡ Ù…ØªÙ†</title>

    <script type="module">
        import * as pdfjsLib from 'https://unpkg.com/pdfjs-dist@5.4.149/build/pdf.mjs';
        pdfjsLib.GlobalWorkerOptions.workerSrc =
            'https://unpkg.com/pdfjs-dist@5.4.149/build/pdf.worker.mjs';

        function fixText(text) {
            text = text.replace(/ÙŠ/g, 'ÛŒ').replace(/Ùƒ/g, 'Ú©');
            text = text.replace(/\s+([.!ØŸ:ØŒØ›])/g, '$1'); // Ø­Ø°Ù ÙØ§ØµÙ„Ù‡ Ù‚Ø¨Ù„ Ø¹Ù„Ø§Ù…Øª
            text = text.replace(/([.!ØŸ:ØŒØ›])(?=[Ø¢-ÛŒA-Za-z0-9])/g, '$1 '); // ÙØ§ØµÙ„Ù‡ Ø¨Ø¹Ø¯ Ø¹Ù„Ø§Ù…Øª
            text = text.replace(/\b(Ù…ÛŒ|Ù†Ù…ÛŒ)\s+(?=[Ø¢-ÛŒ])/g, '$1\u200c'); // Ù†ÛŒÙ… ÙØ§ØµÙ„Ù‡
            text = text.replace(/\s{2,}/g, ' '); // Ø­Ø°Ù ÙØ§ØµÙ„Ù‡ Ø§Ø¶Ø§ÙÛŒ
            return text.trim();
        }

        window.startProcess = async file => {
            const out = document.getElementById('output');
            out.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...';
            document.getElementById('bar').style.width = '0%';

            const buffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;
            let finalText = '';
            const totalPages = pdf.numPages;

            for (let i = 1; i <= totalPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();

                if (!textContent.items.length) {
                    alert('âš ï¸ Ø§ÛŒÙ† PDF Ø§Ø³Ú©Ù† Ø´Ø¯Ù‡ Ø§Ø³Øª. ÙÙ‚Ø· PDF Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.');
                    out.textContent = 'Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…ØªÙˆÙ‚Ù Ø´Ø¯.';
                    document.getElementById('bar').style.width = '0%';
                    return;
                }

                const pageText = textContent.items.map(item => item.str).join(' ');
                finalText += fixText(pageText) + '\n\n';

                // Ø¢Ù¾Ø¯ÛŒØª progress bar
                document.getElementById('bar').style.width = ((i / totalPages) * 100) + '%';
            }

            out.textContent = finalText;
        };
    </script>
</head>

<body>
    <a class="ar" href="index.html">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
    <div class="all-pdf">
        <div class="file-upload">
            <input type="file" id="pdfInput" accept="application/pdf" class="in">
            <label id="pickLabel" class="btn1" for="pdfInput">Ø§Ù†ØªØ®Ø§Ø¨ PDF</label>
        </div>

        <div class="btnd">
            <button onclick="copyText()" class="btnk">ğŸ“‹ Ú©Ù¾ÛŒ</button>
            <button onclick="downloadText()" class="btnk">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯</button>
        </div>

        <div class="progressBox">
            <div class="progressBar" id="bar"></div>
        </div>

        <pre id="output" placeholder="ÙÙ‚Ø· PDF Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯">ÙÙ‚Ø· PDF Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯</pre>
    </div>

    <script>
        pdfInput.onchange = e => {
            if (e.target.files[0]) startProcess(e.target.files[0]);
        };

        function copyText() {
            const text = document.getElementById('output').textContent;
            navigator.clipboard.writeText(text).then(() => alert('Ù…ØªÙ† Ú©Ù¾ÛŒ Ø´Ø¯'))
                .catch(err => alert('Ú©Ù¾ÛŒ Ù†Ø´Ø¯: ' + err));
        }

        function downloadText() {
            const text = document.getElementById('output').textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'text.txt';
            a.click();
        }
    </script>
</body>

</html> -->
