<!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <title>Ù†Ú©ØªØ§ | Ù¾ÛŒ Ø¯ÛŒ Ø§Ù Ø¨Ù‡ Ù…ØªÙ† </title>


    <script type="module">
        import * as pdfjsLib from 'https://unpkg.com/pdfjs-dist@5.4.149/build/pdf.mjs';
        pdfjsLib.GlobalWorkerOptions.workerSrc =
            'https://unpkg.com/pdfjs-dist@5.4.149/build/pdf.worker.mjs';

        window.startProcess = async file => {
            const out = document.getElementById('output');
            out.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´';

            const buffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;

            let finalText = '';
            let totalPages = pdf.numPages;
            let donePages = 0;
            let displayedPercent = 0;

            function smoothUpdate(target) {
                const animate = () => {
                    if (displayedPercent < target) {
                        displayedPercent += Math.min(0.5, target - displayedPercent);
                        document.getElementById('bar').style.width = displayedPercent + '%';
                        requestAnimationFrame(animate);
                    } else {
                        displayedPercent = target;
                        document.getElementById('bar').style.width = displayedPercent + '%';
                    }
                }
                animate();
            }

            for (let i = 1; i <= totalPages; i++) {
                const page = await pdf.getPage(i);
                const viewport = page.getViewport({ scale: 4 });
                const canvas = document.createElement('canvas');
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                const ctx = canvas.getContext('2d');
                await page.render({ canvasContext: ctx, viewport }).promise;

                const { data } = await Tesseract.recognize(
                    canvas,
                    'fas+eng',
                    {
                        logger: m => {
                            if (m.status === 'recognizing text') {
                                const progressPercent = ((donePages + m.progress) / totalPages) * 100;
                                smoothUpdate(progressPercent);
                            }
                        }
                    }
                );

                // ---------- Ø­Ø°Ù Ø¨Ø®Ø´ ØªÙ…Ø±ÛŒÙ†/ÙØ¹Ø§Ù„ÛŒØª/Ù¾Ø§ÙˆØ±Ù‚ÛŒ/Ø¬Ø¯ÙˆÙ„ ---------- 
                const paragraphs = data.blocks
                    .map(b => b.text)
                    .map(bText => {
                        // ØªÙ‚Ø³ÛŒÙ… Ø¨Ù„ÙˆÚ© Ø¨Ù‡ Ø®Ø·ÙˆØ·
                        const lines = bText.split('\n');
                        // Ø­Ø°Ù Ø®Ø·ÙˆØ· Ø­Ø§ÙˆÛŒ Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§
                        const filtered = lines.filter(line => !/(ØªÙ…Ø±ÛŒÙ†|ÙØ¹Ø§Ù„ÛŒØª|Ù¾Ø§ÙˆØ±Ù‚ÛŒ|Ø¬Ø¯ÙˆÙ„)/i.test(line.trim()));
                        return filtered.join(' ').trim(); // Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù† Ø¨Ù„ÙˆÚ© Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
                    })
                    .filter(t => t.length > 0); // Ø­Ø°Ù Ø¨Ù„ÙˆÚ©â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø®Ø§Ù„ÛŒ

                finalText += fixText(paragraphs.join('\n\n')) + '\n\n';
                donePages++;
                smoothUpdate((donePages / totalPages) * 100);
            }

            out.textContent = finalText;
        };

        /* ---------- Ø§ØµÙ„Ø§Ø­ Ù…ØªÙ† ---------- */
        function fixText(text) {
            // 1. Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÛŒ Ùˆ Ù†ÛŒÙ…â€ŒÙØ§ØµÙ„Ù‡
            text = text.replace(/ÙŠ/g, 'ÛŒ').replace(/Ùƒ/g, 'Ú©').replace(/\u200c/g, 'â€Œ');

            // 2. Ù†ÛŒÙ…â€ŒÙØ§ØµÙ„Ù‡ Ù…ÛŒ / Ù†Ù…ÛŒ
            text = text.replace(/\bÙ…ÛŒ\s+/g, 'Ù…ÛŒâ€Œ');
            text = text.replace(/\bÙ†Ù…ÛŒ\s+/g, 'Ù†Ù…ÛŒâ€Œ');

            // 3. Ø­Ø°Ù Ù†ÙˆÛŒØ² Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
            text = text.replace(/([Ø¢-ÛŒÛ°-Û¹])([A-Za-z]+)/g, '$1');
            text = text.replace(/[^Ø¢-ÛŒ0-9Û°-Û¹\s\.\!\?\ØŸ\:\,\-\/\(\)Â«Â»"']/g, '');

            // 4. Ø§ØµÙ„Ø§Ø­ ÙØ§ØµÙ„Ù‡ Ùˆ Ø®Ø·ÙˆØ·
            text = text.replace(/\n+/g, '\n');       // Ú†Ù†Ø¯ Ø®Ø· Ø®Ø§Ù„ÛŒ â†’ ÛŒÚ© Ø®Ø·
            text = text.replace(/\s+/g, ' ').trim(); // ÙØ§ØµÙ„Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡
            text = text.replace(/\n\s+/g, '\n');     // ÙØ§ØµÙ„Ù‡ Ø§Ø¨ØªØ¯Ø§ÛŒ Ø®Ø·

            // 5. Ø§ØµÙ„Ø§Ø­ ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒØ¬ OCR
            const corrections = {
                'Ø¯ Ø±Ø®Øª': 'Ø¯Ø±Ø®Øª',
                'Ø¨Ø§ Ø±': 'Ø¨Ø§Ø±',
                'Ú©Øª Ø§Ø¨': 'Ú©ØªØ§Ø¨',
                'Ù… ÛŒâ€ŒØ±ÙˆÙ…': 'Ù…ÛŒâ€ŒØ±ÙˆÙ…',
                // Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ù…ÙˆØ§Ø±Ø¯ Ø¨ÛŒØ´ØªØ± Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒ
            };
            for (const [wrong, right] of Object.entries(corrections)) {
                text = text.replaceAll(wrong, right);
            }

            return text;
        }







    </script>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
</head>

<body>
    <a class="ar" id="ar" href="index.html">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
    <div class="all-pdf">


        <!-- <h3>OCR ÙØ§Ø±Ø³ÛŒ â€” Ú©ÛŒÙÛŒØª Ø¨Ø§Ù„Ø§ + Smooth Progress</h3> -->




        <div class="file-upload">

            <input type="file" id="pdfInput" accept="application/pdf" class="in">
            <label id="pickLabel" class="btn1" for="pdfInput" title=""></label>

        </div>


        <div class="btnd">

            <button onclick="copyText()" class="btnk">ğŸ“‹ Ú©Ù¾ÛŒ</button>
            <button onclick="downloadText()" class="btnk">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯</button>

        </div>



        <div class="progressBox">
            <div class="progressBar" id="bar"></div>
        </div>
        <pre id="output"
            placeholder="ØªØ§ Ø­Ø¯ Ø§Ù…Ú©Ø§Ù† Ø§Ø² Ù¾ÛŒ Ø¯ÛŒ Ø§Ù Ù‡Ø§ÛŒ Ø§Ø³Ú©Ù† Ø´Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†ÛŒØ¯">ØªØ§ Ø­Ø¯ Ø§Ù…Ú©Ø§Ù† Ø§Ø² Ù¾ÛŒ Ø¯ÛŒ Ø§Ù Ù‡Ø§ÛŒ Ø§Ø³Ú©Ù† Ø´Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ú©Ù†ÛŒØ¯</pre>


    </div>

    <script>
        alert("Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ù‡ Ù…ÛŒØªÙˆÙ†ÛŒØ¯ Ù…ØªÙ† Ù¾ÛŒ Ø¯ÛŒ Ø§Ù Ø±Ùˆ Ø®ÙˆØ¯ØªÙˆÙ† Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯ Ø§Ø² Ø§ÙˆÙ† Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯ ØªØ§ Ù…ØªÙ† Ø¨Ø§ Ø¨Ø§Ù„Ø§ØªØ±ÛŒÙ† Ú©ÛŒÙÛŒØª Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯")
        pdfInput.onchange = e => {
            if (e.target.files[0]) startProcess(e.target.files[0]);
        };

        function copyText() {
            const text = document.getElementById('output').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('Ù…ØªÙ† Ú©Ù¾ÛŒ Ø´Ø¯');
            }).catch(err => {
                alert('Ú©Ù¾ÛŒ Ù†Ø´Ø¯: ' + err);
            });
        }

        function downloadText() {
            const text = output.textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ocr.txt';
            a.click();
        }
    </script>
</body>

</html>





























<!-- <!DOCTYPE html>
<html lang="fa">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <title>Ù†Ú©ØªØ§ | PDF Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ø¨Ù‡ Ù…ØªÙ†</title>

    <script type="module">
        import * as pdfjsLib from 'https://unpkg.com/pdfjs-dist@5.4.149/build/pdf.mjs';
        pdfjsLib.GlobalWorkerOptions.workerSrc =
            'https://unpkg.com/pdfjs-dist@5.4.149/build/pdf.worker.mjs';

        function fixText(text) {
            text = text.replace(/ÙŠ/g, 'ÛŒ').replace(/Ùƒ/g, 'Ú©');
            text = text.replace(/\s+([.!ØŸ:ØŒØ›])/g, '$1'); // Ø­Ø°Ù ÙØ§ØµÙ„Ù‡ Ù‚Ø¨Ù„ Ø¹Ù„Ø§Ù…Øª
            text = text.replace(/([.!ØŸ:ØŒØ›])(?=[Ø¢-ÛŒA-Za-z0-9])/g, '$1 '); // ÙØ§ØµÙ„Ù‡ Ø¨Ø¹Ø¯ Ø¹Ù„Ø§Ù…Øª
            text = text.replace(/\b(Ù…ÛŒ|Ù†Ù…ÛŒ)\s+(?=[Ø¢-ÛŒ])/g, '$1\u200c'); // Ù†ÛŒÙ… ÙØ§ØµÙ„Ù‡
            text = text.replace(/\s{2,}/g, ' '); // Ø­Ø°Ù ÙØ§ØµÙ„Ù‡ Ø§Ø¶Ø§ÙÛŒ
            return text.trim();
        }

        window.startProcess = async file => {
            const out = document.getElementById('output');
            out.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...';
            document.getElementById('bar').style.width = '0%';

            const buffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;
            let finalText = '';
            const totalPages = pdf.numPages;

            for (let i = 1; i <= totalPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();

                if (!textContent.items.length) {
                    alert('âš ï¸ Ø§ÛŒÙ† PDF Ø§Ø³Ú©Ù† Ø´Ø¯Ù‡ Ø§Ø³Øª. ÙÙ‚Ø· PDF Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.');
                    out.textContent = 'Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…ØªÙˆÙ‚Ù Ø´Ø¯.';
                    document.getElementById('bar').style.width = '0%';
                    return;
                }

                const pageText = textContent.items.map(item => item.str).join(' ');
                finalText += fixText(pageText) + '\n\n';

                // Ø¢Ù¾Ø¯ÛŒØª progress bar
                document.getElementById('bar').style.width = ((i / totalPages) * 100) + '%';
            }

            out.textContent = finalText;
        };
    </script>
</head>

<body>
    <a class="ar" href="index.html">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
    <div class="all-pdf">
        <div class="file-upload">
            <input type="file" id="pdfInput" accept="application/pdf" class="in">
            <label id="pickLabel" class="btn1" for="pdfInput">Ø§Ù†ØªØ®Ø§Ø¨ PDF</label>
        </div>

        <div class="btnd">
            <button onclick="copyText()" class="btnk">ğŸ“‹ Ú©Ù¾ÛŒ</button>
            <button onclick="downloadText()" class="btnk">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯</button>
        </div>

        <div class="progressBox">
            <div class="progressBar" id="bar"></div>
        </div>

        <pre id="output" placeholder="ÙÙ‚Ø· PDF Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯">ÙÙ‚Ø· PDF Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯</pre>
    </div>

    <script>
        pdfInput.onchange = e => {
            if (e.target.files[0]) startProcess(e.target.files[0]);
        };

        function copyText() {
            const text = document.getElementById('output').textContent;
            navigator.clipboard.writeText(text).then(() => alert('Ù…ØªÙ† Ú©Ù¾ÛŒ Ø´Ø¯'))
                .catch(err => alert('Ú©Ù¾ÛŒ Ù†Ø´Ø¯: ' + err));
        }

        function downloadText() {
            const text = document.getElementById('output').textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'text.txt';
            a.click();
        }
    </script>
</body>

</html> -->
